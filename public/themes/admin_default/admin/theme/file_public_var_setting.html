<extend name="public@base5"/>
<block name="head">
    <include file="theme/functions"/>
</block>
<block name="main">
    <div class="wrap">
        <div class="position-relative">
            <ul class="nav nav-tabs">
                <li class="nav-item">
                    <a class="nav-link"
                       href="{:url('Theme/fileSetting',['file'=>$fileName,'theme'=>$theme,'tab'=>'widget'])}">
                        组件
                    </a>
                </li>
                <notempty name="file.more.vars">
                    <li class="nav-item">
                        <a class="nav-link"
                           href="{:url('Theme/fileSetting',['file'=>$fileName,'theme'=>$theme,'tab'=>'var'])}">
                            设置
                        </a>
                    </li>
                </notempty>
                <notempty name="has_public_var">
                    <li class="nav-item">
                        <a class="nav-link active"
                           href="{:url('Theme/fileSetting',['file'=>$fileName,'theme'=>$theme,'tab'=>'public_var'])}">
                            全局设置
                        </a>
                    </li>
                </notempty>
            </ul>
            <php>
                $allow_lang_list=cmf_allow_lang_list();
                $content_lang=input('param.admin_content_lang',session('admin_content_lang'));
                $content_lang=$content_lang?$content_lang:'默认语言';
            </php>
            <div class="position-absolute top-0 end-0">
                <div class="dropdown">
                    <button class="btn btn-secondary dropdown-toggle" type="button" data-bs-toggle="dropdown"
                            aria-expanded="false">
                        {$content_lang} <span class="caret"></span>
                    </button>
                    <php>
                        $get_params=input('get.');
                    </php>
                    <ul class="dropdown-menu dropdown-menu-right">
                        <foreach name="$allow_lang_list" item="lang">
                            <php>
                                $get_params['admin_content_lang']=$lang;
                            </php>
                            <li><a class="dropdown-item" href="?{:http_build_query($get_params)}">{$lang}</a></li>
                        </foreach>
                    </ul>
                </div>
            </div>
        </div>

        <form method="post" class="js-ajax-form  margin-top-20" action="admin/theme/{$theme}/file/setting">
            <foreach name="files" item="file">
                <if condition="$file.id neq $file_id">
                    <notempty name="file['more']['vars']">
                        {:_parse_vars($file.more.vars,'files['.$file['id'].'][vars]',1,'',$file['id'])}
                        <else/>
                    </notempty>
                </if>
            </foreach>
            <div style="display: none;">
                <input type="hidden" name="admin_content_lang" value="{$content_lang}"/>
                <button type="submit" class="btn btn-primary js-ajax-submit" id="submit-btn"
                        data-success="successCallback">
                    <i class="fa fa-save fa-fw"></i> {:lang('SAVE')}
                </button>
            </div>
        </form>

    </div>
</block>
<block name="scripts">
    <include file="theme/scripts"/>
    <script>
        function successCallback(data, statusText, xhr, $form) {
            function _refresh() {
                if (data.url) {
                    //返回带跳转地址
                    window.location.href = data.url;
                } else {
                    if (data.code == 1) {
                        //刷新当前页
                        reloadPage(window);
                    }
                }
            }

            noty({
                text: data.msg,
                type: 'success',
                layout: 'topCenter',
                modal: true,
                // animation: {
                //     open: 'animated bounceInDown', // Animate.css class names
                //     close: 'animated bounceOutUp', // Animate.css class names
                // },
                timeout: 800,
                callback: {
                    afterClose: function () {
                        if (parent.afterSaveSetting) {
                            parent.afterSaveSetting();
                        }
                        _refresh();
                    }
                }
            });
        }
    </script>
</block>
